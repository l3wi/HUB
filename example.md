# IOTA Hub Transactions

IOTA Hub is a tool for managing transfers from/to addresses in a simple and secure manner.  In this example, PYOTA is used to create a new user with a deposit address.  This user receives iota then queries for the account balance.  

This example was tested Ubuntu 18.04 LTS Server running Python 3.6.5 with these prerequisites:
```
backcall==0.1.0
decorator==4.3.0
googleapis-common-protos==1.5.3
grpcio==1.15.0
grpcio-tools==1.15.0
ipython==7.0.1
ipython-genutils==0.2.0
jedi==0.13.0
parso==0.3.1
pexpect==4.6.0
pickleshare==0.7.5
prompt-toolkit==2.0.5
protobuf==3.6.1
ptyprocess==0.6.0
Pygments==2.2.0
simplegeneric==0.8.1
six==1.11.0
traitlets==4.3.2
wcwidth==0.1.7
```

IOTA Hub is a gRPC server so import grpc modules.  For more information about gRPC see https://grpc.io/docs/tutorials/  
```
import grpc
from proto import hub_pb2_grpc
from proto import messages_pb2
```

An insecure channel of ‘localhost:50051’ was used for demonstration purposes.  Put your IOTA Hub URI here.

```
chan = grpc.insecure_channel('localhost:50051')
stub = hub_pb2_grpc.HubStub(chan)
```

Create a new user named, "Test.  A new deposit address was generated.  IncludeChecksum=True means that the address will contain the 81-tryte address plus the 9-tryte checksum for a total of 90-trytes.  

```
# Create a new user and generate a deposit address
stub.CreateUser(messages_pb2.CreateUserRequest(userId='Test'))
response = stub.GetDepositAddress(messages_pb2.GetDepositAddressRequest(userId='Test', includeChecksum=True))
print(response.address)
```

Here’s an example deposit address generated by this script:

```
LPEDWLVKSRTRK9DJFTZFCHCHV9LGHXTBZUAVZVVUGPZRQZNNEQZWGNWCIQSQRUXQHOMECW9UICHSKLPEX

```
Next get the account balance in iota.  This will be zero until someone transfers iota into the new deposit address.

```
# Get the balance in IOTA for specified user
response = stub.GetBalance(messages_pb2.GetBalanceRequest(userId='Test'))
print('{}i available '.format(response.available))
```
Finally, see the transaction history for this address.
```
response = stub.GetUserHistory(messages_pb2.GetUserHistoryRequest(userId='Test', newerThan=0))
print('History:')
print(response)
```

In the example, 50i was received.

![](images/ddwiy.png?raw=true)

Now, IOTA Hub takes over and automatically sweeps funds into exchange deposit addresses.  Hub also populates the user database with the user’s name and account information.  This allows the hub to control deposit address indexing and other processes for the safe and efficient currency exchanges.  Tailhash, DDWY…9999, highlighted in orange, will appear in the IOTA Hub database.

![](images/lpedw.png?raw=true)

Query IOTA Hub to view the new username, “Nelson”, and see the account balance of 50i.  Notice, Nelson’s ID is “9”.

![](images/Nelsonsmall.png?raw=true)
 
IOTA Hub tracks the amounts in each tailhash.  Notice tailhash, DDWY…9999, generated during the IOTA Hub deposit address sweep.

![](images/Nelsonlarge.png?raw=true)

IOTA Hub tracks deposit addresses.  Notice:  Nelson’s ID is 9.  The yellow box highlights addresses associated with Nelson’s account

![](images/Nelsonhuge.png?raw=true)

